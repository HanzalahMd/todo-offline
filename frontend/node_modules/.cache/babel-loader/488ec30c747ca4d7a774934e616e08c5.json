{"ast":null,"code":"import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport inherits from 'inherits';\nimport immediate from 'immediate';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport { EventEmitter } from 'events';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\n\nfunction isBinaryObject(object) {\n  return typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer || typeof Blob !== 'undefined' && object instanceof Blob;\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  } // IE10-11 slice() polyfill\n\n\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n\n  var size = object.size;\n  var type = object.type; // Blob\n\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  } // PhantomJS slice() replacement\n\n\n  return object.webkitSlice(0, size, type);\n} // most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n\n  if (proto === null) {\n    // not sure when this happens, but I guess it can\n    return true;\n  }\n\n  var Ctor = proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString;\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n\n    return newObject;\n  } // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n\n\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this; // if the last argument is a function, assume its a callback\n\n    var usedCB = typeof args[args.length - 1] === 'function' ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        }); // create a callback for this invocation\n        // apply the function in the orig context\n\n        args.push(callback);\n        resp = func.apply(self, args);\n\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    }); // if there is a callback, call it back\n\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n\n    self.constructor.emit('debug', logArgs); // override the callback itself to log the response\n\n    var origCallback = args[args.length - 1];\n\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(err ? ['error', err] : ['success', res]);\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n\n    var self = this;\n    logApiCall(self, name, args);\n\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n\n    return callback.apply(this, args);\n  }));\n} // like underscore/lodash _.pick()\n\n\nfunction pick(obj, arr) {\n  var res = {};\n\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n\n  return res;\n} // Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\n\n\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n} // shim for P/CouchDB adapters that don't directly implement _bulk_get\n\n\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs; // consolidate into one request per doc if possible\n\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {\n      results: results\n    });\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {\n      id: id,\n      docs: docs\n    };\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n  var i = 0;\n\n  function nextBatch() {\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId); // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      }); // remove falsey / undefined revisions\n\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs; // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n\n        formatResult = formatResultForOpenRevsGet;\n      } // globally-supplied options\n\n\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n\n        if (err) {\n          result = [{\n            error: err\n          }];\n        } else {\n          result = formatResult(res);\n        }\n\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n} // Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\n\ninherits(Changes, EventEmitter);\n/* istanbul ignore next */\n\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n  attachBrowserEvents(this);\n}\n\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n\n  var self = this;\n  var inprogress = false;\n\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n\n    inprogress = true;\n    var changesOpts = pick(opts, ['style', 'include_docs', 'attachments', 'conflicts', 'filter', 'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs']);\n    /* istanbul ignore next */\n\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n\n      inprogress = false;\n    }).on('error', onError);\n  }\n\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n\n  EventEmitter.prototype.removeListener.call(this, dbName, this._listeners[id]);\n  delete this._listeners[id];\n};\n/* istanbul ignore next */\n\n\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = localStorage[dbName] === \"a\" ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  } // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n\n\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n\n    max = maxTimeout;\n  }\n\n  var ratio = Math.random();\n  var range = max - min;\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n\n  if (!min) {\n    max = 2000;\n  }\n\n  return randomNumber(min, max);\n} // designed to give info to browser users, who are disturbed\n// when they see http errors in the console\n\n\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function assign(target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) {\n          // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n\n      return to;\n    };\n  }\n}\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n\n  return res;\n} // shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\n\n\nfunction f() {}\n\nvar hasName = f.name;\nvar res; // We dont run coverage in IE\n\n/* istanbul ignore else */\n\nif (hasName) {\n  res = function res(fun) {\n    return fun.name;\n  };\n} else {\n  res = function res(fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n\n    if (match && match[1]) {\n      return match[1];\n    } else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res; // Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\n\nfunction invalidIdError(id) {\n  var err;\n\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !/^_(design|local)/.test(id)) {\n    err = createError(RESERVED_ID);\n  }\n\n  if (err) {\n    throw err;\n  }\n} // Checks if a PouchDB object is \"remote\" or not. This is\n\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n\n\n  if (typeof db.type === 'function') {\n    guardedConsole('warn', 'db.type() is deprecated and will be removed in ' + 'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n\n\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) : EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n\n  var parts = s.split('/');\n\n  if (parts.length === 2) {\n    return parts;\n  }\n\n  if (parts.length === 1) {\n    return [s, s];\n  }\n\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n} // originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\n\n\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\", \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName = \"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g; // use the \"loose\" parser\n\n/* eslint maxlen: 0, no-useless-escape: 0 */\n\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n  return uri;\n} // Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n} // this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\n\n\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n\n        doc = {};\n      } // the user might change the _rev, so save it for posterity\n\n\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({\n          updated: false,\n          rev: docRev\n        });\n      } // users aren't allowed to modify these values,\n      // so reset them here\n\n\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };","map":{"version":3,"sources":["/Users/Hanzalah/Desktop/github/todo-offline/rxdb-hasura-demo/node_modules/pouchdb-utils/lib/index-browser.es.js"],"names":["getArguments","Map","inherits","immediate","createError","BAD_REQUEST","INVALID_ID","MISSING_ID","RESERVED_ID","EventEmitter","uuidV4","stringMd5","isBinaryObject","object","ArrayBuffer","Blob","cloneArrayBuffer","buff","slice","target","byteLength","targetArray","Uint8Array","sourceArray","set","cloneBinaryObject","size","type","webkitSlice","funcToString","Function","prototype","toString","objectCtorString","call","Object","isPlainObject","value","proto","getPrototypeOf","Ctor","constructor","clone","newObject","i","len","Array","isArray","length","Date","toISOString","hasOwnProperty","once","fun","called","args","Error","apply","toPromise","func","self","usedCB","pop","promise","Promise","fulfill","reject","resp","callback","err","mesg","push","then","e","result","logApiCall","name","listeners","logArgs","emit","origCallback","res","responseArgs","concat","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","pick","obj","arr","prop","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","forEach","request","has","id","get","numDocs","numDone","perDocResults","collapseResultsAndFinish","results","info","checkDone","gotResult","docIndex","allRequests","key","nextBatch","upTo","Math","min","batch","processBatch","offset","docId","j","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","error","hasLocal","localStorage","setItem","getItem","hasLocalStorage","Changes","attachBrowserEvents","addEventListener","_listeners","addListener","dbName","inprogress","eventFunction","changesOpts","onError","changes","on","c","seq","since","cancelled","onChange","removeListener","notifyLocalWindows","notify","guardedConsole","method","console","arguments","randomNumber","max","maxTimeout","parseInt","ratio","random","range","defaultBackOff","explainError","status","str","assign","to","index","nextSource","nextKey","assign$1","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","f","hasName","match","res$1","invalidIdError","test","isRemote","_remote","listenerCount","ee","parseDesignDocFunctionName","s","parts","split","normalizeDesignDocFunctionName","normalized","join","keys","qName","qParser","parser","parseUri","m","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","tryAndPut","put","deterministic_revs","clonedDoc","v4","toLowerCase","_rev_tree","JSON","stringify","uuid","bulkGetShim","changesHandler","functionName","nextTick","normalizeDdocFunctionName","parseDdocFunctionName"],"mappings":"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","sourcesContent":["import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport inherits from 'inherits';\nimport immediate from 'immediate';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport { EventEmitter } from 'events';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n"]},"metadata":{},"sourceType":"module"}