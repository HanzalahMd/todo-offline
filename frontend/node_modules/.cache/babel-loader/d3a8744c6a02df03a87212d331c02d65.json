{"ast":null,"code":"/**\n * this handles the pouchdb-instance\n * to easy add modules and manipulate things\n * Adapters can be found here:\n * @link https://github.com/pouchdb/pouchdb/tree/master/packages/node_modules\n */\nimport PouchDBCore from 'pouchdb-core'; // pouchdb-find\n\nimport PouchDBFind from 'pouchdb-find';\nPouchDBCore.plugin(PouchDBFind);\n/*\n// comment in to debug\nconst pouchdbDebug = require('pouchdb-debug');\nPouchDB.plugin(pouchdbDebug);\nPouchDB.debug.enable('*');\n*/\n\nimport { newRxError, newRxTypeError } from './rx-error';\n/**\n * get the number of all undeleted documents\n */\n\nexport function countAllUndeleted(pouchdb) {\n  return pouchdb.allDocs({\n    include_docs: false,\n    attachments: false\n  }).then(function (docs) {\n    return docs.rows.filter(function (row) {\n      return !row.id.startsWith('_design/');\n    }).length;\n  });\n}\n/**\n * get a batch of documents from the pouch-instance\n */\n\nexport function getBatch(pouchdb, limit) {\n  if (limit <= 1) {\n    throw newRxError('P1', {\n      limit: limit\n    });\n  }\n\n  return pouchdb.allDocs({\n    include_docs: true,\n    attachments: false,\n    limit: limit\n  }).then(function (docs) {\n    return docs.rows.map(function (row) {\n      return row.doc;\n    }).filter(function (doc) {\n      return !doc._id.startsWith('_design');\n    });\n  });\n}\n/**\n * check if the given module is a leveldown-adapter\n * throws if not\n */\n\nexport function isLevelDown(adapter) {\n  if (!adapter || typeof adapter.super_ !== 'function') {\n    throw newRxError('UT4', {\n      adapter: adapter\n    });\n  }\n}\n/**\n * validates that a given string is ok to be used with couchdb-collection-names\n * @link https://wiki.apache.org/couchdb/HTTP_database_API\n * @throws  {Error}\n */\n\nexport function validateCouchDBString(name) {\n  if (typeof name !== 'string' || name.length === 0) {\n    throw newRxTypeError('UT1', {\n      name: name\n    });\n  } // do not check, if foldername is given\n\n\n  if (name.includes('/') || // unix\n  name.includes('\\\\') // windows\n  ) return true;\n  var regStr = '^[a-z][_$a-z0-9]*$';\n  var reg = new RegExp(regStr);\n\n  if (!name.match(reg)) {\n    throw newRxError('UT2', {\n      regex: regStr,\n      givenName: name\n    });\n  }\n\n  return true;\n}\n/**\n * get the correct function-name for pouchdb-replication\n */\n\nexport function pouchReplicationFunction(pouch, _ref) {\n  var _ref$pull = _ref.pull,\n      pull = _ref$pull === void 0 ? true : _ref$pull,\n      _ref$push = _ref.push,\n      push = _ref$push === void 0 ? true : _ref$push;\n  if (pull && push) return pouch.sync.bind(pouch);\n  if (!pull && push) return pouch.replicate.to.bind(pouch);\n  if (pull && !push) return pouch.replicate.from.bind(pouch);\n\n  if (!pull && !push) {\n    throw newRxError('UT3', {\n      pull: pull,\n      push: push\n    });\n  }\n}\nexport function isInstanceOf(obj) {\n  return obj instanceof PouchDBCore;\n}\nexport var PouchDB = PouchDBCore;","map":{"version":3,"sources":["/Users/Hanzalah/Desktop/github/todo-offline/rxdb-hasura-demo/node_modules/rxdb/dist/es/pouch-db.js"],"names":["PouchDBCore","PouchDBFind","plugin","newRxError","newRxTypeError","countAllUndeleted","pouchdb","allDocs","include_docs","attachments","then","docs","rows","filter","row","id","startsWith","length","getBatch","limit","map","doc","_id","isLevelDown","adapter","super_","validateCouchDBString","name","includes","regStr","reg","RegExp","match","regex","givenName","pouchReplicationFunction","pouch","_ref","_ref$pull","pull","_ref$push","push","sync","bind","replicate","to","from","isInstanceOf","obj","PouchDB"],"mappings":"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","sourcesContent":["/**\n * this handles the pouchdb-instance\n * to easy add modules and manipulate things\n * Adapters can be found here:\n * @link https://github.com/pouchdb/pouchdb/tree/master/packages/node_modules\n */\nimport PouchDBCore from 'pouchdb-core'; // pouchdb-find\n\nimport PouchDBFind from 'pouchdb-find';\nPouchDBCore.plugin(PouchDBFind);\n/*\n// comment in to debug\nconst pouchdbDebug = require('pouchdb-debug');\nPouchDB.plugin(pouchdbDebug);\nPouchDB.debug.enable('*');\n*/\n\nimport { newRxError, newRxTypeError } from './rx-error';\n\n/**\n * get the number of all undeleted documents\n */\nexport function countAllUndeleted(pouchdb) {\n  return pouchdb.allDocs({\n    include_docs: false,\n    attachments: false\n  }).then(function (docs) {\n    return docs.rows.filter(function (row) {\n      return !row.id.startsWith('_design/');\n    }).length;\n  });\n}\n/**\n * get a batch of documents from the pouch-instance\n */\n\nexport function getBatch(pouchdb, limit) {\n  if (limit <= 1) {\n    throw newRxError('P1', {\n      limit: limit\n    });\n  }\n\n  return pouchdb.allDocs({\n    include_docs: true,\n    attachments: false,\n    limit: limit\n  }).then(function (docs) {\n    return docs.rows.map(function (row) {\n      return row.doc;\n    }).filter(function (doc) {\n      return !doc._id.startsWith('_design');\n    });\n  });\n}\n/**\n * check if the given module is a leveldown-adapter\n * throws if not\n */\n\nexport function isLevelDown(adapter) {\n  if (!adapter || typeof adapter.super_ !== 'function') {\n    throw newRxError('UT4', {\n      adapter: adapter\n    });\n  }\n}\n/**\n * validates that a given string is ok to be used with couchdb-collection-names\n * @link https://wiki.apache.org/couchdb/HTTP_database_API\n * @throws  {Error}\n */\n\nexport function validateCouchDBString(name) {\n  if (typeof name !== 'string' || name.length === 0) {\n    throw newRxTypeError('UT1', {\n      name: name\n    });\n  } // do not check, if foldername is given\n\n\n  if (name.includes('/') || // unix\n  name.includes('\\\\') // windows\n  ) return true;\n  var regStr = '^[a-z][_$a-z0-9]*$';\n  var reg = new RegExp(regStr);\n\n  if (!name.match(reg)) {\n    throw newRxError('UT2', {\n      regex: regStr,\n      givenName: name\n    });\n  }\n\n  return true;\n}\n/**\n * get the correct function-name for pouchdb-replication\n */\n\nexport function pouchReplicationFunction(pouch, _ref) {\n  var _ref$pull = _ref.pull,\n      pull = _ref$pull === void 0 ? true : _ref$pull,\n      _ref$push = _ref.push,\n      push = _ref$push === void 0 ? true : _ref$push;\n  if (pull && push) return pouch.sync.bind(pouch);\n  if (!pull && push) return pouch.replicate.to.bind(pouch);\n  if (pull && !push) return pouch.replicate.from.bind(pouch);\n\n  if (!pull && !push) {\n    throw newRxError('UT3', {\n      pull: pull,\n      push: push\n    });\n  }\n}\nexport function isInstanceOf(obj) {\n  return obj instanceof PouchDBCore;\n}\nexport var PouchDB = PouchDBCore;\n//# sourceMappingURL=pouch-db.js.map"]},"metadata":{},"sourceType":"module"}