{"ast":null,"code":"var genobj = require('generate-object-property');\n\nvar genfun = require('generate-function');\n\nvar jsonpointer = require('jsonpointer');\n\nvar xtend = require('xtend');\n\nvar formats = require('./formats');\n\nvar get = function get(obj, additionalSchemas, ptr) {\n  var visit = function visit(sub) {\n    if (sub && sub.id === ptr) return sub;\n    if (typeof sub !== 'object' || !sub) return null;\n    return Object.keys(sub).reduce(function (res, k) {\n      return res || visit(sub[k]);\n    }, null);\n  };\n\n  var res = visit(obj);\n  if (res) return res;\n  ptr = ptr.replace(/^#/, '');\n  ptr = ptr.replace(/\\/$/, '');\n\n  try {\n    return jsonpointer.get(obj, decodeURI(ptr));\n  } catch (err) {\n    var end = ptr.indexOf('#');\n    var other; // external reference\n\n    if (end !== 0) {\n      // fragment doesn't exist.\n      if (end === -1) {\n        other = additionalSchemas[ptr];\n      } else {\n        var ext = ptr.slice(0, end);\n        other = additionalSchemas[ext];\n        var fragment = ptr.slice(end).replace(/^#/, '');\n\n        try {\n          return jsonpointer.get(other, fragment);\n        } catch (err) {}\n      }\n    } else {\n      other = additionalSchemas[ptr];\n    }\n\n    return other || null;\n  }\n};\n\nvar types = {};\n\ntypes.any = function () {\n  return 'true';\n};\n\ntypes.null = function (name) {\n  return name + ' === null';\n};\n\ntypes.boolean = function (name) {\n  return 'typeof ' + name + ' === \"boolean\"';\n};\n\ntypes.array = function (name) {\n  return 'Array.isArray(' + name + ')';\n};\n\ntypes.object = function (name) {\n  return 'typeof ' + name + ' === \"object\" && ' + name + ' && !Array.isArray(' + name + ')';\n};\n\ntypes.number = function (name) {\n  return 'typeof ' + name + ' === \"number\" && isFinite(' + name + ')';\n};\n\ntypes.integer = function (name) {\n  return 'typeof ' + name + ' === \"number\" && (Math.floor(' + name + ') === ' + name + ' || ' + name + ' > 9007199254740992 || ' + name + ' < -9007199254740992)';\n};\n\ntypes.string = function (name) {\n  return 'typeof ' + name + ' === \"string\"';\n};\n\nvar unique = function unique(array, len) {\n  len = Math.min(len === -1 ? array.length : len, array.length);\n  var list = [];\n\n  for (var i = 0; i < len; i++) {\n    list.push(typeof array[i] === 'object' ? JSON.stringify(array[i]) : array[i]);\n  }\n\n  for (var i = 1; i < list.length; i++) {\n    if (list.indexOf(list[i]) !== i) return false;\n  }\n\n  return true;\n};\n\nvar isMultipleOf = function isMultipleOf(name, multipleOf) {\n  var res;\n  var factor = (multipleOf | 0) !== multipleOf ? Math.pow(10, multipleOf.toString().split('.').pop().length) : 1;\n\n  if (factor > 1) {\n    var factorName = (name | 0) !== name ? Math.pow(10, name.toString().split('.').pop().length) : 1;\n    if (factorName > factor) res = true;else res = Math.round(factor * name) % (factor * multipleOf);\n  } else res = name % multipleOf;\n\n  return !res;\n};\n\nvar testLimitedRegex = function testLimitedRegex(r, s, maxLength) {\n  if (maxLength > -1 && s.length > maxLength) return true;\n  return r.test(s);\n};\n\nvar compile = function compile(schema, cache, root, reporter, opts) {\n  var fmts = opts ? xtend(formats, opts.formats) : formats;\n  var scope = {\n    unique: unique,\n    formats: fmts,\n    isMultipleOf: isMultipleOf,\n    testLimitedRegex: testLimitedRegex\n  };\n  var verbose = opts ? !!opts.verbose : false;\n  var greedy = opts && opts.greedy !== undefined ? opts.greedy : false;\n  var syms = {};\n  var allocated = [];\n\n  var gensym = function gensym(name) {\n    var res = name + (syms[name] = (syms[name] || 0) + 1);\n    allocated.push(res);\n    return res;\n  };\n\n  var formatName = function formatName(field) {\n    var s = JSON.stringify(field);\n\n    try {\n      var pattern = /\\[([^\\[\\]\"]+)\\]/;\n\n      while (pattern.test(s)) {\n        s = s.replace(pattern, replacer);\n      }\n\n      return s;\n    } catch (_) {\n      return JSON.stringify(field);\n    }\n\n    function replacer(match, v) {\n      if (allocated.indexOf(v) === -1) throw new Error('Unreplaceable');\n      return '.\" + ' + v + ' + \"';\n    }\n  };\n\n  var reversePatterns = {};\n\n  var patterns = function patterns(p) {\n    if (reversePatterns[p]) return reversePatterns[p];\n    var n = gensym('pattern');\n    scope[n] = new RegExp(p);\n    reversePatterns[p] = n;\n    return n;\n  };\n\n  var vars = ['i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'x', 'y', 'z'];\n\n  var genloop = function genloop() {\n    var v = vars.shift();\n    vars.push(v + v[0]);\n    allocated.push(v);\n    return v;\n  };\n\n  var visit = function visit(name, node, reporter, filter, schemaPath) {\n    var properties = node.properties;\n    var type = node.type;\n    var tuple = false;\n\n    if (Array.isArray(node.items)) {\n      // tuple type\n      properties = {};\n      node.items.forEach(function (item, i) {\n        properties[i] = item;\n      });\n      type = 'array';\n      tuple = true;\n    }\n\n    var indent = 0;\n\n    var error = function error(msg, prop, value) {\n      validate('errors++');\n\n      if (reporter === true) {\n        validate('if (validate.errors === null) validate.errors = []');\n\n        if (verbose) {\n          validate('validate.errors.push({field:%s,message:%s,value:%s,type:%s,schemaPath:%s})', formatName(prop || name), JSON.stringify(msg), value || name, JSON.stringify(type), JSON.stringify(schemaPath));\n        } else {\n          validate('validate.errors.push({field:%s,message:%s})', formatName(prop || name), JSON.stringify(msg));\n        }\n      }\n    };\n\n    if (node.required === true) {\n      indent++;\n      validate('if (%s === undefined) {', name);\n      error('is required');\n      validate('} else {');\n    } else {\n      indent++;\n      validate('if (%s !== undefined) {', name);\n    }\n\n    var valid = [].concat(type).map(function (t) {\n      if (t && !types.hasOwnProperty(t)) {\n        throw new Error('Unknown type: ' + t);\n      }\n\n      return types[t || 'any'](name);\n    }).join(' || ') || 'true';\n\n    if (valid !== 'true') {\n      indent++;\n      validate('if (!(%s)) {', valid);\n      error('is the wrong type');\n      validate('} else {');\n    }\n\n    if (tuple) {\n      if (node.additionalItems === false) {\n        validate('if (%s.length > %d) {', name, node.items.length);\n        error('has additional items');\n        validate('}');\n      } else if (node.additionalItems) {\n        var i = genloop();\n        validate('for (var %s = %d; %s < %s.length; %s++) {', i, node.items.length, i, name, i);\n        visit(name + '[' + i + ']', node.additionalItems, reporter, filter, schemaPath.concat('additionalItems'));\n        validate('}');\n      }\n    }\n\n    if (node.format && fmts[node.format]) {\n      if (type !== 'string' && formats[node.format]) validate('if (%s) {', types.string(name));\n      var n = gensym('format');\n      scope[n] = fmts[node.format];\n      if (typeof scope[n] === 'function') validate('if (!%s(%s)) {', n, name);else validate('if (!testLimitedRegex(%s, %s, %d)) {', n, name, typeof node.maxLength === 'undefined' ? -1 : node.maxLength);\n      error('must be ' + node.format + ' format');\n      validate('}');\n      if (type !== 'string' && formats[node.format]) validate('}');\n    }\n\n    if (Array.isArray(node.required)) {\n      var n = gensym('missing');\n      validate('var %s = 0', n);\n\n      var checkRequired = function checkRequired(req) {\n        var prop = genobj(name, req);\n        validate('if (%s === undefined) {', prop);\n        error('is required', prop);\n        validate('%s++', n);\n        validate('}');\n      };\n\n      validate('if ((%s)) {', type !== 'object' ? types.object(name) : 'true');\n      node.required.map(checkRequired);\n      validate('}');\n\n      if (!greedy) {\n        validate('if (%s === 0) {', n);\n        indent++;\n      }\n    }\n\n    if (node.uniqueItems) {\n      if (type !== 'array') validate('if (%s) {', types.array(name));\n      validate('if (!(unique(%s, %d))) {', name, node.maxItems || -1);\n      error('must be unique');\n      validate('}');\n      if (type !== 'array') validate('}');\n    }\n\n    if (node.enum) {\n      var complex = node.enum.some(function (e) {\n        return typeof e === 'object';\n      });\n      var compare = complex ? function (e) {\n        return 'JSON.stringify(' + name + ')' + ' !== JSON.stringify(' + JSON.stringify(e) + ')';\n      } : function (e) {\n        return name + ' !== ' + JSON.stringify(e);\n      };\n      validate('if (%s) {', node.enum.map(compare).join(' && ') || 'false');\n      error('must be an enum value');\n      validate('}');\n    }\n\n    if (node.dependencies) {\n      if (type !== 'object') validate('if (%s) {', types.object(name));\n      Object.keys(node.dependencies).forEach(function (key) {\n        var deps = node.dependencies[key];\n        if (typeof deps === 'string') deps = [deps];\n\n        var exists = function exists(k) {\n          return genobj(name, k) + ' !== undefined';\n        };\n\n        if (Array.isArray(deps)) {\n          validate('if (%s !== undefined && !(%s)) {', genobj(name, key), deps.map(exists).join(' && ') || 'true');\n          error('dependencies not set');\n          validate('}');\n        }\n\n        if (typeof deps === 'object') {\n          validate('if (%s !== undefined) {', genobj(name, key));\n          visit(name, deps, reporter, filter, schemaPath.concat(['dependencies', key]));\n          validate('}');\n        }\n      });\n      if (type !== 'object') validate('}');\n    }\n\n    if (node.additionalProperties || node.additionalProperties === false) {\n      if (type !== 'object') validate('if (%s) {', types.object(name));\n      var i = genloop();\n      var keys = gensym('keys');\n\n      var toCompare = function toCompare(p) {\n        return keys + '[' + i + '] !== ' + JSON.stringify(p);\n      };\n\n      var toTest = function toTest(p) {\n        return '!' + patterns(p) + '.test(' + keys + '[' + i + '])';\n      };\n\n      var additionalProp = Object.keys(properties || {}).map(toCompare).concat(Object.keys(node.patternProperties || {}).map(toTest)).join(' && ') || 'true';\n      validate('var %s = Object.keys(%s)', keys, name)('for (var %s = 0; %s < %s.length; %s++) {', i, i, keys, i)('if (%s) {', additionalProp);\n\n      if (node.additionalProperties === false) {\n        if (filter) validate('delete %s', name + '[' + keys + '[' + i + ']]');\n        error('has additional properties', null, JSON.stringify(name + '.') + ' + ' + keys + '[' + i + ']');\n      } else {\n        visit(name + '[' + keys + '[' + i + ']]', node.additionalProperties, reporter, filter, schemaPath.concat(['additionalProperties']));\n      }\n\n      validate('}')('}');\n      if (type !== 'object') validate('}');\n    }\n\n    if (node.$ref) {\n      var sub = get(root, opts && opts.schemas || {}, node.$ref);\n\n      if (sub) {\n        var fn = cache[node.$ref];\n\n        if (!fn) {\n          cache[node.$ref] = function proxy(data) {\n            return fn(data);\n          };\n\n          fn = compile(sub, cache, root, false, opts);\n        }\n\n        var n = gensym('ref');\n        scope[n] = fn;\n        validate('if (!(%s(%s))) {', n, name);\n        error('referenced schema does not match');\n        validate('}');\n      }\n    }\n\n    if (node.not) {\n      var prev = gensym('prev');\n      validate('var %s = errors', prev);\n      visit(name, node.not, false, filter, schemaPath.concat('not'));\n      validate('if (%s === errors) {', prev);\n      error('negative schema matches');\n      validate('} else {')('errors = %s', prev)('}');\n    }\n\n    if (node.items && !tuple) {\n      if (type !== 'array') validate('if (%s) {', types.array(name));\n      var i = genloop();\n      validate('for (var %s = 0; %s < %s.length; %s++) {', i, i, name, i);\n      visit(name + '[' + i + ']', node.items, reporter, filter, schemaPath.concat('items'));\n      validate('}');\n      if (type !== 'array') validate('}');\n    }\n\n    if (node.patternProperties) {\n      if (type !== 'object') validate('if (%s) {', types.object(name));\n      var keys = gensym('keys');\n      var i = genloop();\n      validate('var %s = Object.keys(%s)', keys, name)('for (var %s = 0; %s < %s.length; %s++) {', i, i, keys, i);\n      Object.keys(node.patternProperties).forEach(function (key) {\n        var p = patterns(key);\n        validate('if (%s.test(%s)) {', p, keys + '[' + i + ']');\n        visit(name + '[' + keys + '[' + i + ']]', node.patternProperties[key], reporter, filter, schemaPath.concat(['patternProperties', key]));\n        validate('}');\n      });\n      validate('}');\n      if (type !== 'object') validate('}');\n    }\n\n    if (node.pattern) {\n      var p = patterns(node.pattern);\n      if (type !== 'string') validate('if (%s) {', types.string(name));\n      validate('if (!(testLimitedRegex(%s, %s, %d))) {', p, name, typeof node.maxLength === 'undefined' ? -1 : node.maxLength);\n      error('pattern mismatch');\n      validate('}');\n      if (type !== 'string') validate('}');\n    }\n\n    if (node.allOf) {\n      node.allOf.forEach(function (sch, key) {\n        visit(name, sch, reporter, filter, schemaPath.concat(['allOf', key]));\n      });\n    }\n\n    if (node.anyOf && node.anyOf.length) {\n      var prev = gensym('prev');\n      node.anyOf.forEach(function (sch, i) {\n        if (i === 0) {\n          validate('var %s = errors', prev);\n        } else {\n          validate('if (errors !== %s) {', prev)('errors = %s', prev);\n        }\n\n        visit(name, sch, false, false, schemaPath);\n      });\n      node.anyOf.forEach(function (sch, i) {\n        if (i) validate('}');\n      });\n      validate('if (%s !== errors) {', prev);\n      error('no schemas match');\n      validate('}');\n    }\n\n    if (node.oneOf && node.oneOf.length) {\n      var prev = gensym('prev');\n      var passes = gensym('passes');\n      validate('var %s = errors', prev)('var %s = 0', passes);\n      node.oneOf.forEach(function (sch, i) {\n        visit(name, sch, false, false, schemaPath);\n        validate('if (%s === errors) {', prev)('%s++', passes)('} else {')('errors = %s', prev)('}');\n      });\n      validate('if (%s !== 1) {', passes);\n      error('no (or more than one) schemas match');\n      validate('}');\n    }\n\n    if (node.multipleOf !== undefined) {\n      if (type !== 'number' && type !== 'integer') validate('if (%s) {', types.number(name));\n      validate('if (!isMultipleOf(%s, %d)) {', name, node.multipleOf);\n      error('has a remainder');\n      validate('}');\n      if (type !== 'number' && type !== 'integer') validate('}');\n    }\n\n    if (node.maxProperties !== undefined) {\n      if (type !== 'object') validate('if (%s) {', types.object(name));\n      validate('if (Object.keys(%s).length > %d) {', name, node.maxProperties);\n      error('has more properties than allowed');\n      validate('}');\n      if (type !== 'object') validate('}');\n    }\n\n    if (node.minProperties !== undefined) {\n      if (type !== 'object') validate('if (%s) {', types.object(name));\n      validate('if (Object.keys(%s).length < %d) {', name, node.minProperties);\n      error('has less properties than allowed');\n      validate('}');\n      if (type !== 'object') validate('}');\n    }\n\n    if (node.maxItems !== undefined) {\n      if (type !== 'array') validate('if (%s) {', types.array(name));\n      validate('if (%s.length > %d) {', name, node.maxItems);\n      error('has more items than allowed');\n      validate('}');\n      if (type !== 'array') validate('}');\n    }\n\n    if (node.minItems !== undefined) {\n      if (type !== 'array') validate('if (%s) {', types.array(name));\n      validate('if (%s.length < %d) {', name, node.minItems);\n      error('has less items than allowed');\n      validate('}');\n      if (type !== 'array') validate('}');\n    }\n\n    if (node.maxLength !== undefined) {\n      if (type !== 'string') validate('if (%s) {', types.string(name));\n      validate('if (%s.length > %d) {', name, node.maxLength);\n      error('has longer length than allowed');\n      validate('}');\n      if (type !== 'string') validate('}');\n    }\n\n    if (node.minLength !== undefined) {\n      if (type !== 'string') validate('if (%s) {', types.string(name));\n      validate('if (%s.length < %d) {', name, node.minLength);\n      error('has less length than allowed');\n      validate('}');\n      if (type !== 'string') validate('}');\n    }\n\n    if (node.minimum !== undefined) {\n      if (type !== 'number' && type !== 'integer') validate('if (%s) {', types.number(name));\n      validate('if (%s %s %d) {', name, node.exclusiveMinimum ? '<=' : '<', node.minimum);\n      error('is less than minimum');\n      validate('}');\n      if (type !== 'number' && type !== 'integer') validate('}');\n    }\n\n    if (node.maximum !== undefined) {\n      if (type !== 'number' && type !== 'integer') validate('if (%s) {', types.number(name));\n      validate('if (%s %s %d) {', name, node.exclusiveMaximum ? '>=' : '>', node.maximum);\n      error('is more than maximum');\n      validate('}');\n      if (type !== 'number' && type !== 'integer') validate('}');\n    }\n\n    if (properties) {\n      Object.keys(properties).forEach(function (p) {\n        if (Array.isArray(type) && type.indexOf('null') !== -1) validate('if (%s !== null) {', name);\n        visit(genobj(name, p), properties[p], reporter, filter, schemaPath.concat(tuple ? p : ['properties', p]));\n        if (Array.isArray(type) && type.indexOf('null') !== -1) validate('}');\n      });\n    }\n\n    while (indent--) {\n      validate('}');\n    }\n  };\n\n  var validate = genfun('function validate(data) {') // Since undefined is not a valid JSON value, we coerce to null and other checks will catch this\n  ('if (data === undefined) data = null')('validate.errors = null')('var errors = 0');\n  visit('data', schema, reporter, opts && opts.filter, []);\n  validate('return errors === 0')('}');\n  validate = validate.toFunction(scope);\n  validate.errors = null;\n\n  if (Object.defineProperty) {\n    Object.defineProperty(validate, 'error', {\n      get: function get() {\n        if (!validate.errors) return '';\n        return validate.errors.map(function (err) {\n          return err.field + ' ' + err.message;\n        }).join('\\n');\n      }\n    });\n  }\n\n  validate.toJSON = function () {\n    return schema;\n  };\n\n  return validate;\n};\n\nmodule.exports = function (schema, opts) {\n  if (typeof schema === 'string') schema = JSON.parse(schema);\n  return compile(schema, {}, schema, true, opts);\n};\n\nmodule.exports.filter = function (schema, opts) {\n  var validate = module.exports(schema, xtend(opts, {\n    filter: true\n  }));\n  return function (sch) {\n    validate(sch);\n    return sch;\n  };\n};","map":{"version":3,"sources":["/Users/Hanzalah/Desktop/github/todo-offline/rxdb-hasura-demo/node_modules/is-my-json-valid/index.js"],"names":["genobj","require","genfun","jsonpointer","xtend","formats","get","obj","additionalSchemas","ptr","visit","sub","id","Object","keys","reduce","res","k","replace","decodeURI","err","end","indexOf","other","ext","slice","fragment","types","any","null","name","boolean","array","object","number","integer","string","unique","len","Math","min","length","list","i","push","JSON","stringify","isMultipleOf","multipleOf","factor","pow","toString","split","pop","factorName","round","testLimitedRegex","r","s","maxLength","test","compile","schema","cache","root","reporter","opts","fmts","scope","verbose","greedy","undefined","syms","allocated","gensym","formatName","field","pattern","replacer","_","match","v","Error","reversePatterns","patterns","p","n","RegExp","vars","genloop","shift","node","filter","schemaPath","properties","type","tuple","Array","isArray","items","forEach","item","indent","error","msg","prop","value","validate","required","valid","concat","map","t","hasOwnProperty","join","additionalItems","format","checkRequired","req","uniqueItems","maxItems","enum","complex","some","e","compare","dependencies","key","deps","exists","additionalProperties","toCompare","toTest","additionalProp","patternProperties","$ref","schemas","fn","proxy","data","not","prev","allOf","sch","anyOf","oneOf","passes","maxProperties","minProperties","minItems","minLength","minimum","exclusiveMinimum","maximum","exclusiveMaximum","toFunction","errors","defineProperty","message","toJSON","module","exports","parse"],"mappings":"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","sourcesContent":["var genobj = require('generate-object-property')\nvar genfun = require('generate-function')\nvar jsonpointer = require('jsonpointer')\nvar xtend = require('xtend')\nvar formats = require('./formats')\n\nvar get = function(obj, additionalSchemas, ptr) {\n\n  var visit = function(sub) {\n    if (sub && sub.id === ptr) return sub\n    if (typeof sub !== 'object' || !sub) return null\n    return Object.keys(sub).reduce(function(res, k) {\n      return res || visit(sub[k])\n    }, null)\n  }\n\n  var res = visit(obj)\n  if (res) return res\n\n  ptr = ptr.replace(/^#/, '')\n  ptr = ptr.replace(/\\/$/, '')\n\n  try {\n    return jsonpointer.get(obj, decodeURI(ptr))\n  } catch (err) {\n    var end = ptr.indexOf('#')\n    var other\n    // external reference\n    if (end !== 0) {\n      // fragment doesn't exist.\n      if (end === -1) {\n        other = additionalSchemas[ptr]\n      } else {\n        var ext = ptr.slice(0, end)\n        other = additionalSchemas[ext]\n        var fragment = ptr.slice(end).replace(/^#/, '')\n        try {\n          return jsonpointer.get(other, fragment)\n        } catch (err) {}\n      }\n    } else {\n      other = additionalSchemas[ptr]\n    }\n    return other || null\n  }\n}\n\nvar types = {}\n\ntypes.any = function() {\n  return 'true'\n}\n\ntypes.null = function(name) {\n  return name+' === null'\n}\n\ntypes.boolean = function(name) {\n  return 'typeof '+name+' === \"boolean\"'\n}\n\ntypes.array = function(name) {\n  return 'Array.isArray('+name+')'\n}\n\ntypes.object = function(name) {\n  return 'typeof '+name+' === \"object\" && '+name+' && !Array.isArray('+name+')'\n}\n\ntypes.number = function(name) {\n  return 'typeof '+name+' === \"number\" && isFinite('+name+')'\n}\n\ntypes.integer = function(name) {\n  return 'typeof '+name+' === \"number\" && (Math.floor('+name+') === '+name+' || '+name+' > 9007199254740992 || '+name+' < -9007199254740992)'\n}\n\ntypes.string = function(name) {\n  return 'typeof '+name+' === \"string\"'\n}\n\nvar unique = function(array, len) {\n  len = Math.min(len === -1 ? array.length : len, array.length)\n  var list = []\n  for (var i = 0; i < len; i++) {\n    list.push(typeof array[i] === 'object' ? JSON.stringify(array[i]) : array[i])\n  }\n  for (var i = 1; i < list.length; i++) {\n    if (list.indexOf(list[i]) !== i) return false\n  }\n  return true\n}\n\nvar isMultipleOf = function(name, multipleOf) {\n  var res;\n  var factor = ((multipleOf | 0) !== multipleOf) ? Math.pow(10, multipleOf.toString().split('.').pop().length) : 1\n  if (factor > 1) {\n    var factorName = ((name | 0) !== name) ? Math.pow(10, name.toString().split('.').pop().length) : 1\n    if (factorName > factor) res = true\n    else res = Math.round(factor * name) % (factor * multipleOf)\n  }\n  else res = name % multipleOf;\n  return !res;\n}\n\nvar testLimitedRegex = function (r, s, maxLength) {\n  if (maxLength > -1 && s.length > maxLength) return true\n  return r.test(s)\n}\n\nvar compile = function(schema, cache, root, reporter, opts) {\n  var fmts = opts ? xtend(formats, opts.formats) : formats\n  var scope = {unique:unique, formats:fmts, isMultipleOf:isMultipleOf, testLimitedRegex:testLimitedRegex}\n  var verbose = opts ? !!opts.verbose : false;\n  var greedy = opts && opts.greedy !== undefined ?\n    opts.greedy : false;\n\n  var syms = {}\n  var allocated = []\n  var gensym = function(name) {\n    var res = name+(syms[name] = (syms[name] || 0)+1)\n    allocated.push(res)\n    return res\n  }\n\n  var formatName = function(field) {\n    var s = JSON.stringify(field)\n    try {\n      var pattern = /\\[([^\\[\\]\"]+)\\]/\n      while (pattern.test(s)) s = s.replace(pattern, replacer)\n      return s\n    } catch (_) {\n      return JSON.stringify(field)\n    }\n\n    function replacer (match, v) {\n      if (allocated.indexOf(v) === -1) throw new Error('Unreplaceable')\n      return '.\" + ' + v + ' + \"'\n    }\n  }\n\n  var reversePatterns = {}\n  var patterns = function(p) {\n    if (reversePatterns[p]) return reversePatterns[p]\n    var n = gensym('pattern')\n    scope[n] = new RegExp(p)\n    reversePatterns[p] = n\n    return n\n  }\n\n  var vars = ['i','j','k','l','m','n','o','p','q','r','s','t','u','v','x','y','z']\n  var genloop = function() {\n    var v = vars.shift()\n    vars.push(v+v[0])\n    allocated.push(v)\n    return v\n  }\n\n  var visit = function(name, node, reporter, filter, schemaPath) {\n    var properties = node.properties\n    var type = node.type\n    var tuple = false\n\n    if (Array.isArray(node.items)) { // tuple type\n      properties = {}\n      node.items.forEach(function(item, i) {\n        properties[i] = item\n      })\n      type = 'array'\n      tuple = true\n    }\n\n    var indent = 0\n    var error = function(msg, prop, value) {\n      validate('errors++')\n      if (reporter === true) {\n        validate('if (validate.errors === null) validate.errors = []')\n        if (verbose) {\n          validate(\n            'validate.errors.push({field:%s,message:%s,value:%s,type:%s,schemaPath:%s})',\n            formatName(prop || name),\n            JSON.stringify(msg),\n            value || name,\n            JSON.stringify(type),\n            JSON.stringify(schemaPath)\n          )\n        } else {\n          validate('validate.errors.push({field:%s,message:%s})', formatName(prop || name), JSON.stringify(msg))\n        }\n      }\n    }\n\n    if (node.required === true) {\n      indent++\n      validate('if (%s === undefined) {', name)\n      error('is required')\n      validate('} else {')\n    } else {\n      indent++\n      validate('if (%s !== undefined) {', name)\n    }\n\n    var valid = [].concat(type)\n      .map(function(t) {\n        if (t && !types.hasOwnProperty(t)) {\n          throw new Error('Unknown type: ' + t)\n        }\n\n        return types[t || 'any'](name)\n      })\n      .join(' || ') || 'true'\n\n    if (valid !== 'true') {\n      indent++\n      validate('if (!(%s)) {', valid)\n      error('is the wrong type')\n      validate('} else {')\n    }\n\n    if (tuple) {\n      if (node.additionalItems === false) {\n        validate('if (%s.length > %d) {', name, node.items.length)\n        error('has additional items')\n        validate('}')\n      } else if (node.additionalItems) {\n        var i = genloop()\n        validate('for (var %s = %d; %s < %s.length; %s++) {', i, node.items.length, i, name, i)\n        visit(name+'['+i+']', node.additionalItems, reporter, filter, schemaPath.concat('additionalItems'))\n        validate('}')\n      }\n    }\n\n    if (node.format && fmts[node.format]) {\n      if (type !== 'string' && formats[node.format]) validate('if (%s) {', types.string(name))\n      var n = gensym('format')\n      scope[n] = fmts[node.format]\n\n      if (typeof scope[n] === 'function') validate('if (!%s(%s)) {', n, name)\n      else validate('if (!testLimitedRegex(%s, %s, %d)) {', n, name, typeof node.maxLength === 'undefined' ? -1 : node.maxLength)\n      error('must be '+node.format+' format')\n      validate('}')\n      if (type !== 'string' && formats[node.format]) validate('}')\n    }\n\n    if (Array.isArray(node.required)) {\n      var n = gensym('missing')\n      validate('var %s = 0', n)\n      var checkRequired = function (req) {\n        var prop = genobj(name, req);\n        validate('if (%s === undefined) {', prop)\n        error('is required', prop)\n        validate('%s++', n)\n        validate('}')\n      }\n      validate('if ((%s)) {', type !== 'object' ? types.object(name) : 'true')\n      node.required.map(checkRequired)\n      validate('}');\n      if (!greedy) {\n        validate('if (%s === 0) {', n)\n        indent++\n      }\n    }\n\n    if (node.uniqueItems) {\n      if (type !== 'array') validate('if (%s) {', types.array(name))\n      validate('if (!(unique(%s, %d))) {', name, node.maxItems || -1)\n      error('must be unique')\n      validate('}')\n      if (type !== 'array') validate('}')\n    }\n\n    if (node.enum) {\n      var complex = node.enum.some(function(e) {\n        return typeof e === 'object'\n      })\n\n      var compare = complex ?\n        function(e) {\n          return 'JSON.stringify('+name+')'+' !== JSON.stringify('+JSON.stringify(e)+')'\n        } :\n        function(e) {\n          return name+' !== '+JSON.stringify(e)\n        }\n\n      validate('if (%s) {', node.enum.map(compare).join(' && ') || 'false')\n      error('must be an enum value')\n      validate('}')\n    }\n\n    if (node.dependencies) {\n      if (type !== 'object') validate('if (%s) {', types.object(name))\n\n      Object.keys(node.dependencies).forEach(function(key) {\n        var deps = node.dependencies[key]\n        if (typeof deps === 'string') deps = [deps]\n\n        var exists = function(k) {\n          return genobj(name, k) + ' !== undefined'\n        }\n\n        if (Array.isArray(deps)) {\n          validate('if (%s !== undefined && !(%s)) {', genobj(name, key), deps.map(exists).join(' && ') || 'true')\n          error('dependencies not set')\n          validate('}')\n        }\n        if (typeof deps === 'object') {\n          validate('if (%s !== undefined) {', genobj(name, key))\n          visit(name, deps, reporter, filter, schemaPath.concat(['dependencies', key]))\n          validate('}')\n        }\n      })\n\n      if (type !== 'object') validate('}')\n    }\n\n    if (node.additionalProperties || node.additionalProperties === false) {\n      if (type !== 'object') validate('if (%s) {', types.object(name))\n\n      var i = genloop()\n      var keys = gensym('keys')\n\n      var toCompare = function(p) {\n        return keys+'['+i+'] !== '+JSON.stringify(p)\n      }\n\n      var toTest = function(p) {\n        return '!'+patterns(p)+'.test('+keys+'['+i+'])'\n      }\n\n      var additionalProp = Object.keys(properties || {}).map(toCompare)\n        .concat(Object.keys(node.patternProperties || {}).map(toTest))\n        .join(' && ') || 'true'\n\n      validate('var %s = Object.keys(%s)', keys, name)\n        ('for (var %s = 0; %s < %s.length; %s++) {', i, i, keys, i)\n          ('if (%s) {', additionalProp)\n\n      if (node.additionalProperties === false) {\n        if (filter) validate('delete %s', name+'['+keys+'['+i+']]')\n        error('has additional properties', null, JSON.stringify(name+'.') + ' + ' + keys + '['+i+']')\n      } else {\n        visit(name+'['+keys+'['+i+']]', node.additionalProperties, reporter, filter, schemaPath.concat(['additionalProperties']))\n      }\n\n      validate\n          ('}')\n        ('}')\n\n      if (type !== 'object') validate('}')\n    }\n\n    if (node.$ref) {\n      var sub = get(root, opts && opts.schemas || {}, node.$ref)\n      if (sub) {\n        var fn = cache[node.$ref]\n        if (!fn) {\n          cache[node.$ref] = function proxy(data) {\n            return fn(data)\n          }\n          fn = compile(sub, cache, root, false, opts)\n        }\n        var n = gensym('ref')\n        scope[n] = fn\n        validate('if (!(%s(%s))) {', n, name)\n        error('referenced schema does not match')\n        validate('}')\n      }\n    }\n\n    if (node.not) {\n      var prev = gensym('prev')\n      validate('var %s = errors', prev)\n      visit(name, node.not, false, filter, schemaPath.concat('not'))\n      validate('if (%s === errors) {', prev)\n      error('negative schema matches')\n      validate('} else {')\n        ('errors = %s', prev)\n      ('}')\n    }\n\n    if (node.items && !tuple) {\n      if (type !== 'array') validate('if (%s) {', types.array(name))\n\n      var i = genloop()\n      validate('for (var %s = 0; %s < %s.length; %s++) {', i, i, name, i)\n      visit(name+'['+i+']', node.items, reporter, filter, schemaPath.concat('items'))\n      validate('}')\n\n      if (type !== 'array') validate('}')\n    }\n\n    if (node.patternProperties) {\n      if (type !== 'object') validate('if (%s) {', types.object(name))\n      var keys = gensym('keys')\n      var i = genloop()\n      validate\n        ('var %s = Object.keys(%s)', keys, name)\n        ('for (var %s = 0; %s < %s.length; %s++) {', i, i, keys, i)\n\n      Object.keys(node.patternProperties).forEach(function(key) {\n        var p = patterns(key)\n        validate('if (%s.test(%s)) {', p, keys+'['+i+']')\n        visit(name+'['+keys+'['+i+']]', node.patternProperties[key], reporter, filter, schemaPath.concat(['patternProperties', key]))\n        validate('}')\n      })\n\n      validate('}')\n      if (type !== 'object') validate('}')\n    }\n\n    if (node.pattern) {\n      var p = patterns(node.pattern)\n      if (type !== 'string') validate('if (%s) {', types.string(name))\n      validate('if (!(testLimitedRegex(%s, %s, %d))) {', p, name, typeof node.maxLength === 'undefined' ? -1 : node.maxLength)\n      error('pattern mismatch')\n      validate('}')\n      if (type !== 'string') validate('}')\n    }\n\n    if (node.allOf) {\n      node.allOf.forEach(function(sch, key) {\n        visit(name, sch, reporter, filter, schemaPath.concat(['allOf', key]))\n      })\n    }\n\n    if (node.anyOf && node.anyOf.length) {\n      var prev = gensym('prev')\n\n      node.anyOf.forEach(function(sch, i) {\n        if (i === 0) {\n          validate('var %s = errors', prev)\n        } else {\n          validate('if (errors !== %s) {', prev)\n            ('errors = %s', prev)\n        }\n        visit(name, sch, false, false, schemaPath)\n      })\n      node.anyOf.forEach(function(sch, i) {\n        if (i) validate('}')\n      })\n      validate('if (%s !== errors) {', prev)\n      error('no schemas match')\n      validate('}')\n    }\n\n    if (node.oneOf && node.oneOf.length) {\n      var prev = gensym('prev')\n      var passes = gensym('passes')\n\n      validate\n        ('var %s = errors', prev)\n        ('var %s = 0', passes)\n\n      node.oneOf.forEach(function(sch, i) {\n        visit(name, sch, false, false, schemaPath)\n        validate('if (%s === errors) {', prev)\n          ('%s++', passes)\n        ('} else {')\n          ('errors = %s', prev)\n        ('}')\n      })\n\n      validate('if (%s !== 1) {', passes)\n      error('no (or more than one) schemas match')\n      validate('}')\n    }\n\n    if (node.multipleOf !== undefined) {\n      if (type !== 'number' && type !== 'integer') validate('if (%s) {', types.number(name))\n\n      validate('if (!isMultipleOf(%s, %d)) {', name, node.multipleOf)\n\n      error('has a remainder')\n      validate('}')\n\n      if (type !== 'number' && type !== 'integer') validate('}')\n    }\n\n    if (node.maxProperties !== undefined) {\n      if (type !== 'object') validate('if (%s) {', types.object(name))\n\n      validate('if (Object.keys(%s).length > %d) {', name, node.maxProperties)\n      error('has more properties than allowed')\n      validate('}')\n\n      if (type !== 'object') validate('}')\n    }\n\n    if (node.minProperties !== undefined) {\n      if (type !== 'object') validate('if (%s) {', types.object(name))\n\n      validate('if (Object.keys(%s).length < %d) {', name, node.minProperties)\n      error('has less properties than allowed')\n      validate('}')\n\n      if (type !== 'object') validate('}')\n    }\n\n    if (node.maxItems !== undefined) {\n      if (type !== 'array') validate('if (%s) {', types.array(name))\n\n      validate('if (%s.length > %d) {', name, node.maxItems)\n      error('has more items than allowed')\n      validate('}')\n\n      if (type !== 'array') validate('}')\n    }\n\n    if (node.minItems !== undefined) {\n      if (type !== 'array') validate('if (%s) {', types.array(name))\n\n      validate('if (%s.length < %d) {', name, node.minItems)\n      error('has less items than allowed')\n      validate('}')\n\n      if (type !== 'array') validate('}')\n    }\n\n    if (node.maxLength !== undefined) {\n      if (type !== 'string') validate('if (%s) {', types.string(name))\n\n      validate('if (%s.length > %d) {', name, node.maxLength)\n      error('has longer length than allowed')\n      validate('}')\n\n      if (type !== 'string') validate('}')\n    }\n\n    if (node.minLength !== undefined) {\n      if (type !== 'string') validate('if (%s) {', types.string(name))\n\n      validate('if (%s.length < %d) {', name, node.minLength)\n      error('has less length than allowed')\n      validate('}')\n\n      if (type !== 'string') validate('}')\n    }\n\n    if (node.minimum !== undefined) {\n      if (type !== 'number' && type !== 'integer') validate('if (%s) {', types.number(name))\n\n      validate('if (%s %s %d) {', name, node.exclusiveMinimum ? '<=' : '<', node.minimum)\n      error('is less than minimum')\n      validate('}')\n\n      if (type !== 'number' && type !== 'integer') validate('}')\n    }\n\n    if (node.maximum !== undefined) {\n      if (type !== 'number' && type !== 'integer') validate('if (%s) {', types.number(name))\n\n      validate('if (%s %s %d) {', name, node.exclusiveMaximum ? '>=' : '>', node.maximum)\n      error('is more than maximum')\n      validate('}')\n\n      if (type !== 'number' && type !== 'integer') validate('}')\n    }\n\n    if (properties) {\n      Object.keys(properties).forEach(function(p) {\n        if (Array.isArray(type) && type.indexOf('null') !== -1) validate('if (%s !== null) {', name)\n\n        visit(\n          genobj(name, p),\n          properties[p],\n          reporter,\n          filter,\n          schemaPath.concat(tuple ? p : ['properties', p])\n        )\n\n        if (Array.isArray(type) && type.indexOf('null') !== -1) validate('}')\n      })\n    }\n\n    while (indent--) validate('}')\n  }\n\n  var validate = genfun\n    ('function validate(data) {')\n      // Since undefined is not a valid JSON value, we coerce to null and other checks will catch this\n      ('if (data === undefined) data = null')\n      ('validate.errors = null')\n      ('var errors = 0')\n\n  visit('data', schema, reporter, opts && opts.filter, [])\n\n  validate\n      ('return errors === 0')\n    ('}')\n\n  validate = validate.toFunction(scope)\n  validate.errors = null\n\n  if (Object.defineProperty) {\n    Object.defineProperty(validate, 'error', {\n      get: function() {\n        if (!validate.errors) return ''\n        return validate.errors.map(function(err) {\n          return err.field + ' ' + err.message;\n        }).join('\\n')\n      }\n    })\n  }\n\n  validate.toJSON = function() {\n    return schema\n  }\n\n  return validate\n}\n\nmodule.exports = function(schema, opts) {\n  if (typeof schema === 'string') schema = JSON.parse(schema)\n  return compile(schema, {}, schema, true, opts)\n}\n\nmodule.exports.filter = function(schema, opts) {\n  var validate = module.exports(schema, xtend(opts, {filter: true}))\n  return function(sch) {\n    validate(sch)\n    return sch\n  }\n}\n"]},"metadata":{},"sourceType":"script"}