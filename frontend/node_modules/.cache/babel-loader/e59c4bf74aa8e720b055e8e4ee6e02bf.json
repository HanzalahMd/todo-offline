{"ast":null,"code":"import objectPath from 'object-path';\nimport { lastOfArray, UNKNOWN_VALUE } from '../util';\nexport var hasLimit = function hasLimit(input) {\n  return !!input.queryParams.limit;\n};\nexport var isFindOne = function isFindOne(input) {\n  return input.queryParams.limit === 1;\n};\nexport var hasSkip = function hasSkip(input) {\n  if (input.queryParams.skip && input.queryParams.skip > 0) {\n    return true;\n  } else {\n    return false;\n  }\n};\nexport var isDelete = function isDelete(input) {\n  return input.changeEvent.operation === 'DELETE';\n};\nexport var isInsert = function isInsert(input) {\n  return input.changeEvent.operation === 'INSERT';\n};\nexport var isUpdate = function isUpdate(input) {\n  return input.changeEvent.operation === 'UPDATE';\n};\nexport var previousUnknown = function previousUnknown(input) {\n  return input.changeEvent.previous === UNKNOWN_VALUE;\n};\nexport var wasLimitReached = function wasLimitReached(input) {\n  return hasLimit(input) && input.previousResults.length >= input.queryParams.limit;\n};\nexport var sortParamsChanged = function sortParamsChanged(input) {\n  var sortFields = input.queryParams.sortFields;\n  var prev = input.changeEvent.previous;\n  var doc = input.changeEvent.doc;\n\n  if (!doc) {\n    return false;\n  }\n\n  if (!prev || prev === UNKNOWN_VALUE) {\n    return true;\n  }\n\n  for (var i = 0; i < sortFields.length; i++) {\n    var field = sortFields[i];\n    var beforeData = objectPath.get(prev, field);\n    var afterData = objectPath.get(doc, field);\n\n    if (beforeData !== afterData) {\n      return true;\n    }\n  }\n\n  return false;\n};\nexport var wasInResult = function wasInResult(input) {\n  var id = input.changeEvent.id;\n\n  if (input.keyDocumentMap) {\n    var has = input.keyDocumentMap.has(id);\n    return has;\n  } else {\n    var primary = input.queryParams.primaryKey;\n    var results = input.previousResults;\n\n    for (var i = 0; i < results.length; i++) {\n      var item = results[i];\n\n      if (item[primary] === id) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n};\nexport var wasSortedBeforeFirst = function wasSortedBeforeFirst(input) {\n  var prev = input.changeEvent.previous;\n\n  if (!prev || prev === UNKNOWN_VALUE) {\n    return false;\n  }\n\n  var first = input.previousResults[0];\n\n  if (!first) {\n    return false;\n  }\n\n  var comp = input.queryParams.sortComparator(prev, first);\n  return comp < 0;\n};\nexport var wasSortedAfterLast = function wasSortedAfterLast(input) {\n  var prev = input.changeEvent.previous;\n\n  if (!prev || prev === UNKNOWN_VALUE) {\n    return false;\n  }\n\n  var last = lastOfArray(input.previousResults);\n\n  if (!last) {\n    return false;\n  }\n\n  var comp = input.queryParams.sortComparator(prev, last);\n  return comp > 0;\n};\nexport var isSortedBeforeFirst = function isSortedBeforeFirst(input) {\n  var doc = input.changeEvent.doc;\n\n  if (!doc) {\n    return false;\n  }\n\n  var first = input.previousResults[0];\n\n  if (!first) {\n    return false;\n  }\n\n  var comp = input.queryParams.sortComparator(doc, first);\n  return comp < 0;\n};\nexport var isSortedAfterLast = function isSortedAfterLast(input) {\n  var doc = input.changeEvent.doc;\n\n  if (!doc) {\n    return false;\n  }\n\n  var last = lastOfArray(input.previousResults);\n\n  if (!last) {\n    return false;\n  }\n\n  var comp = input.queryParams.sortComparator(doc, last);\n  return comp > 0;\n};\nexport var wasMatching = function wasMatching(input) {\n  var prev = input.changeEvent.previous;\n\n  if (!prev || prev === UNKNOWN_VALUE) {\n    return false;\n  }\n\n  return input.queryParams.queryMatcher(prev);\n};\nexport var doesMatchNow = function doesMatchNow(input) {\n  var doc = input.changeEvent.doc;\n\n  if (!doc) {\n    return false;\n  }\n\n  var ret = input.queryParams.queryMatcher(doc);\n  return ret;\n};\nexport var wasResultsEmpty = function wasResultsEmpty(input) {\n  return input.previousResults.length === 0;\n};","map":{"version":3,"sources":["../../../src/states/state-resolver.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import objectPath from 'object-path';\nimport { lastOfArray, UNKNOWN_VALUE } from '../util';\nexport var hasLimit = function (input) {\n    return !!input.queryParams.limit;\n};\nexport var isFindOne = function (input) {\n    return input.queryParams.limit === 1;\n};\nexport var hasSkip = function (input) {\n    if (input.queryParams.skip && input.queryParams.skip > 0) {\n        return true;\n    }\n    else {\n        return false;\n    }\n};\nexport var isDelete = function (input) {\n    return input.changeEvent.operation === 'DELETE';\n};\nexport var isInsert = function (input) {\n    return input.changeEvent.operation === 'INSERT';\n};\nexport var isUpdate = function (input) {\n    return input.changeEvent.operation === 'UPDATE';\n};\nexport var previousUnknown = function (input) {\n    return input.changeEvent.previous === UNKNOWN_VALUE;\n};\nexport var wasLimitReached = function (input) {\n    return hasLimit(input) && input.previousResults.length >= input.queryParams.limit;\n};\nexport var sortParamsChanged = function (input) {\n    var sortFields = input.queryParams.sortFields;\n    var prev = input.changeEvent.previous;\n    var doc = input.changeEvent.doc;\n    if (!doc) {\n        return false;\n    }\n    if (!prev || prev === UNKNOWN_VALUE) {\n        return true;\n    }\n    for (var i = 0; i < sortFields.length; i++) {\n        var field = sortFields[i];\n        var beforeData = objectPath.get(prev, field);\n        var afterData = objectPath.get(doc, field);\n        if (beforeData !== afterData) {\n            return true;\n        }\n    }\n    return false;\n};\nexport var wasInResult = function (input) {\n    var id = input.changeEvent.id;\n    if (input.keyDocumentMap) {\n        var has = input.keyDocumentMap.has(id);\n        return has;\n    }\n    else {\n        var primary = input.queryParams.primaryKey;\n        var results = input.previousResults;\n        for (var i = 0; i < results.length; i++) {\n            var item = results[i];\n            if (item[primary] === id) {\n                return true;\n            }\n        }\n        return false;\n    }\n};\nexport var wasSortedBeforeFirst = function (input) {\n    var prev = input.changeEvent.previous;\n    if (!prev || prev === UNKNOWN_VALUE) {\n        return false;\n    }\n    var first = input.previousResults[0];\n    if (!first) {\n        return false;\n    }\n    var comp = input.queryParams.sortComparator(prev, first);\n    return comp < 0;\n};\nexport var wasSortedAfterLast = function (input) {\n    var prev = input.changeEvent.previous;\n    if (!prev || prev === UNKNOWN_VALUE) {\n        return false;\n    }\n    var last = lastOfArray(input.previousResults);\n    if (!last) {\n        return false;\n    }\n    var comp = input.queryParams.sortComparator(prev, last);\n    return comp > 0;\n};\nexport var isSortedBeforeFirst = function (input) {\n    var doc = input.changeEvent.doc;\n    if (!doc) {\n        return false;\n    }\n    var first = input.previousResults[0];\n    if (!first) {\n        return false;\n    }\n    var comp = input.queryParams.sortComparator(doc, first);\n    return comp < 0;\n};\nexport var isSortedAfterLast = function (input) {\n    var doc = input.changeEvent.doc;\n    if (!doc) {\n        return false;\n    }\n    var last = lastOfArray(input.previousResults);\n    if (!last) {\n        return false;\n    }\n    var comp = input.queryParams.sortComparator(doc, last);\n    return comp > 0;\n};\nexport var wasMatching = function (input) {\n    var prev = input.changeEvent.previous;\n    if (!prev || prev === UNKNOWN_VALUE) {\n        return false;\n    }\n    return input.queryParams.queryMatcher(prev);\n};\nexport var doesMatchNow = function (input) {\n    var doc = input.changeEvent.doc;\n    if (!doc) {\n        return false;\n    }\n    var ret = input.queryParams.queryMatcher(doc);\n    return ret;\n};\nexport var wasResultsEmpty = function (input) {\n    return input.previousResults.length === 0;\n};\n//# sourceMappingURL=state-resolver.js.map"]},"metadata":{},"sourceType":"module"}